<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMeans Clustering - Proyecto de Machine Learning</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="./tytus.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <!-- Botón para regresar al index -->
    <a href="index.html" class="btn btn-secondary position-fixed top-0 end-0 m-3">Volver al Inicio</a>

    <div class="container my-5">
        <h1 class="text-center mb-4">KMeans Clustering</h1>
        
        <!-- Selección de tipo de análisis -->
        <div class="mb-3">
            <label for="type_select" class="form-label">Seleccione el tipo de datos:</label>
            <select class="form-select" id="type_select">
                <option value="lineal">Lineal</option>
                <option value="2d">2 Dimensiones</option>
            </select>
        </div>

        <!-- Campo de entrada para cantidad de clusters -->
        <div class="mb-3">
            <label for="cluster_count" class="form-label">Cantidad de Clusters</label>
            <input type="number" class="form-control" id="cluster_count" placeholder="Ingrese la cantidad de clusters" value="3">
        </div>

        <!-- Campo de entrada para datos (cambia según el tipo) -->
        <div class="mb-3">
            <label for="data_input" class="form-label">Datos</label>
            <input type="text" class="form-control" id="data_input" placeholder="Ingrese los datos según el tipo seleccionado">
        </div>

        <!-- Campo de entrada para cantidad de iteraciones -->
        <div class="mb-3">
            <label for="iterations" class="form-label">Cantidad de Iteraciones</label>
            <input type="number" class="form-control" id="iterations" placeholder="Ingrese la cantidad de iteraciones" value="3">
        </div>

        <!-- Botón para calcular KMeans -->
        <div class="d-flex justify-content-center mb-4">
            <button id="calculate_button" class="btn btn-primary">Calcular KMeans</button>
        </div>

        <!-- Contenedor para gráficos y resultados -->
        <h3 class="text-center mt-5">Resultados del KMeans:</h3>
        <div id="chart_div" class="container mt-4" style="width: 900px; height: 500px; border: 2px solid #60A0FF; border-radius: 10px;"></div>
    </div>

    <script>
        document.getElementById('type_select').addEventListener('change', function () {
            const type = document.getElementById('type_select').value;
            const dataInput = document.getElementById('data_input');
            dataInput.placeholder = type === 'lineal' 
                ? 'Ingrese los números separados por comas (0,1,2,...)' 
                : 'Ingrese los puntos en formato [x,y] separados por comas ([0,0],[0,1],...)';
            dataInput.value = type === 'lineal' 
                ? '-99,-92,-89,-87,-83,-82,-78,-76,-70,-62,-57,-55,-50,-42,-35,-33,-32,-30,-27,-17,-12,-10,0,1,2,25,29,33,39,41,53,54,67' 
                : '[11,6],[4,2],[15,0],[10,6],[7,8],[9,12],[13,0],[5,1],[0,13],[7,5],[6,1],[3,6],[0,10],[14,10],[6,14],[6,4],[4,9],[5,14],[9,9],[13,8]';
        });

        document.getElementById('calculate_button').onclick = function () {
            const type = document.getElementById('type_select').value;
            const clusterCount = parseInt(document.getElementById('cluster_count').value);
            const iterations = parseInt(document.getElementById('iterations').value);
            const dataInput = document.getElementById('data_input').value;

            if (type === 'lineal') {
                calculateLinealKMeans(clusterCount, iterations, dataInput);
            } else {
                calculate2DKMeans(clusterCount, iterations, dataInput);
            }
        };

        function calculateLinealKMeans(clusterCount, iterations, dataInput) {
            const data = dataInput.split(',').map(Number).filter(val => !isNaN(val));

            if (data.length < clusterCount) {
                alert(`El número de clusters (${clusterCount}) no puede ser mayor que la cantidad de datos (${data.length})`);
                return;
            }

            const kmeans = new LinearKMeans(clusterCount, data);
            const clusterizedData = kmeans.clusterize(clusterCount, data, iterations);

            const clusters = Array.from(new Set(clusterizedData.map(a => a[1]))).map(cluster => [cluster, getRandomColor()]);
            google.charts.load('current', { 'packages': ['corechart'] });
            google.charts.setOnLoadCallback(() => drawChartLineal(clusterizedData, clusters));
        }

        function calculate2DKMeans(clusterCount, iterations, dataInput) {
            const data = dataInput.replace(/\s/g, '').replace(/\[/g, '').split('],').map(d => d.replace(']', '').split(',').map(Number));

            if (data.length < clusterCount) {
                alert(`El número de clusters (${clusterCount}) no puede ser mayor que la cantidad de datos (${data.length})`);
                return;
            }

            const kmeans = new _2DKMeans(clusterCount, data);
            const clusterizedData = kmeans.clusterize(clusterCount, data, iterations);

            const clusters = Array.from(new Set(clusterizedData.map(a => JSON.stringify(a[1]))))
                .map(cluster => [JSON.parse(cluster), getRandomColor()]);
            google.charts.load('current', { 'packages': ['corechart'] });
            google.charts.setOnLoadCallback(() => drawChart2D(clusterizedData, clusters));
        }

        function drawChartLineal(clusterizedData, clusters) {
            const graphData = new google.visualization.DataTable();
            graphData.addColumn('number', 'X');
            graphData.addColumn('number', 'Y');
            graphData.addColumn({ type: 'string', role: 'style' });

            clusterizedData.forEach(e => {
                graphData.addRow([e[0], 0, `point { size: 7; shape-type: diamond; fill-color: ${clusters.find(c => c[0] === e[1])[1]}`]);
            });

            clusters.forEach(c => {
                graphData.addRow([c[0], 0, `point { size: 10; shape-type: square; fill-color: #FF0000`]);
            });

            const options = {
                title: 'Distribución Lineal de Clusters',
                seriesType: 'scatter',
                hAxis: { title: 'X' },
                vAxis: { title: 'Y' },
                legend: 'none'
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));
            chart.draw(graphData, options);
        }

        function drawChart2D(clusterizedData, clusters) {
            const graphData = new google.visualization.DataTable();
            graphData.addColumn('number', 'X');
            graphData.addColumn('number', 'Y');
            graphData.addColumn({ type: 'string', role: 'style' });

            clusterizedData.forEach(e => {
                graphData.addRow([e[0][0], e[0][1], `point { size: 7; shape-type: diamond; fill-color: ${clusters.find(c => JSON.stringify(c[0]) === JSON.stringify(e[1]))[1]}`]);
            });

            clusters.forEach(c => {
                graphData.addRow([c[0][0], c[0][1], `point { size: 10; shape-type: square; fill-color: #FF0000`]);
            });

            const options = {
                title: 'Distribución de Clusters en 2D',
                seriesType: 'scatter',
                hAxis: { title: 'X' },
                vAxis: { title: 'Y' },
                legend: 'none'
            };

            const chart = new google.visualization.ScatterChart(document.getElementById('chart_div'));
            chart.draw(graphData, options);
        }

        function getRandomColor() {
            return "#" + Math.floor(Math.random() * 16777215).toString(16);
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
